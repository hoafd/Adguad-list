name: Check Repository Storage Usage

on:
  workflow_dispatch: # B·∫•m tay ƒë·ªÉ ki·ªÉm tra

permissions:
  contents: read

jobs:
  check-size:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # T·∫£i to√†n b·ªô ƒë·ªÉ ƒëo ƒë∆∞·ª£c l·ªãch s·ª≠ Git

      - name: Calculate Storage Usage
        run: |
          echo "===================================================="
          echo "üìä B√ÅO C√ÅO C√ÇN ƒêO ƒêONG ƒê·∫æM REPO - HOA FD"
          echo "===================================================="
          
          echo -e "\n1Ô∏è‚É£ T·ªîNG DUNG L∆Ø·ª¢NG TO√ÄN B·ªò REPO (G·ªíM C·∫¢ L·ªäCH S·ª¨):"
          echo "ƒê√¢y l√† con s·ªë GitHub d√πng ƒë·ªÉ t√≠nh gi·ªõi h·∫°n cho n√≠."
          du -sh .
          
          echo -e "\n2Ô∏è‚É£ DUNG L∆Ø·ª¢NG L·ªäCH S·ª¨ ·∫®N (TH∆Ø M·ª§C .GIT):"
          echo "C√°i n√†y c√†ng l·ªõn nghƒ©a l√† n√≠ c√†ng c·∫≠p nh·∫≠t nhi·ªÅu l·∫ßn."
          du -sh .git

          echo -e "\n3Ô∏è‚É£ DUNG L∆Ø·ª¢NG C√ÅC FILE HI·ªÜN T·∫†I (WORKING TREE):"
          echo "ƒê√¢y l√† dung l∆∞·ª£ng th·ª±c t·∫ø c·ªßa c√°c file n√≠ ƒëang d√πng."
          # ƒêo t·ªïng dung l∆∞·ª£ng tr·ª´ th∆∞ m·ª•c .git
          du -sh --exclude=.git .

          echo -e "\n4Ô∏è‚É£ CHI TI·∫æT T·ª™NG FILE HI·ªÜN T·∫†I (N·∫∂NG NH·∫§T):"
          # Li·ªát k√™ c√°c file hi·ªán t·∫°i, kh√¥ng t√≠nh ƒë·ªëng r√°c trong .git
          find . -type f -not -path '*/.*' -exec du -h {} + | sort -hr | head -n 15

          echo -e "\n5Ô∏è‚É£ DUNG L∆Ø·ª¢NG C√ÅC TH∆Ø M·ª§C CH√çNH:"
          du -sh output/ backup/ my-rules/ config/ 2>/dev/null || echo "Ch∆∞a c√≥ d·ªØ li·ªáu."
          
          echo "===================================================="
          echo "üí° Ghi ch√∫: N·∫øu m·ª•c (1) > 500MB, n√≠ n√™n c√¢n nh·∫Øc b·∫•m d·ªçn d·∫πp!"
          echo "===================================================="
          
